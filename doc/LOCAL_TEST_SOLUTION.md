# âœ… å®Œæ•´è§£å†³æ–¹æ¡ˆï¼šæœ¬åœ°æµ‹è¯• Dmit åº“å­˜æ£€æŸ¥

## ğŸ¯ ä½ çš„é—®é¢˜

> æ˜¯å¦æœ‰æœ¬åœ°éƒ¨ç½²åˆ° cloudflare å¹¶æµ‹è¯•çš„æ–¹æ¡ˆï¼Ÿå¹¶ä¸éœ€è¦æ¯æ¬¡æäº¤ä»£ç åˆ°ä»“åº“æ‰èƒ½éªŒè¯

## âœ… ç­”æ¡ˆï¼šæœ‰ï¼ä½¿ç”¨ Remote Dev

Cloudflare æä¾›äº† `wrangler dev --remote` åŠŸèƒ½ï¼š
- âœ… ä»£ç åœ¨ **Cloudflare è¾¹ç¼˜ç½‘ç»œ**è¿è¡Œ
- âœ… è¯·æ±‚ä» **Cloudflare IP** å‘å‡ºï¼ˆä¸æ˜¯æœ¬åœ° IPï¼‰
- âœ… **å®æ—¶åŒæ­¥**ä»£ç æ›´æ”¹
- âœ… **æ— éœ€æäº¤ä»£ç **æˆ–æ­£å¼éƒ¨ç½²
- âœ… **å®Œå…¨å…è´¹**

## ğŸš€ ç«‹å³å¼€å§‹ï¼ˆ3 æ­¥ï¼‰

### æ­¥éª¤ 1: å¯åŠ¨ Remote Dev

```bash
npm run dev:remote
```

ç­‰å¾…çœ‹åˆ°ï¼š
```
â›…ï¸ wrangler 3.x.x
ğŸŒ Listening on http://127.0.0.1:8787
```

### æ­¥éª¤ 2: æµ‹è¯•

**æ–°ç»ˆç«¯çª—å£**ä¸­è¿è¡Œï¼š

```bash
./test-dmit.sh
```

æˆ–è€…æ‰‹åŠ¨æµ‹è¯•ï¼š

```bash
curl "http://127.0.0.1:8787/test-dmit?url=https://www.dmit.io/cart.php?gid=1"
```

### æ­¥éª¤ 3: æŸ¥çœ‹ç»“æœ

#### âœ… æˆåŠŸç¤ºä¾‹

```json
{
  "success": true,
  "duration": "1234ms",
  "status": {
    "inStock": true,
    "price": 99.99
  }
}
```

**è¯´æ˜**: ğŸ‰ å¯ä»¥ç»•è¿‡ Cloudflareï¼ç»§ç»­å¼€å‘ã€‚

#### âŒ å¤±è´¥ç¤ºä¾‹

```json
{
  "success": false,
  "error": "403 Forbidden"
}
```

**è¯´æ˜**: ä»è¢«æ‹¦æˆªï¼Œéœ€è¦å…¶ä»–æ–¹æ¡ˆã€‚

## ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | éœ€è¦éƒ¨ç½² | èƒ½å¦ç»•è¿‡ Cloudflare | å®æ—¶æ›´æ–° | æ¨èåº¦ |
|------|----------|---------------------|----------|--------|
| **Remote Dev** â­ | âŒ ä¸éœ€è¦ | âœ… å¯èƒ½ | âœ… æ˜¯ | â­â­â­â­â­ |
| æœ¬åœ° Dev | âŒ ä¸éœ€è¦ | âŒ ä¸èƒ½ | âœ… æ˜¯ | â­â­ |
| æ­£å¼éƒ¨ç½² | âœ… éœ€è¦ | âœ… å¯èƒ½ | âŒ å¦ | â­â­â­ |

## ğŸ”„ å¼€å‘å·¥ä½œæµ

```bash
# ç»ˆç«¯ 1: å¯åŠ¨ remote dev
npm run dev:remote

# ç»ˆç«¯ 2: æµ‹è¯•
./test-dmit.sh

# ä¿®æ”¹ä»£ç ï¼ˆå¦‚ src/providers/dmit.tsï¼‰
# ä¿å­˜åè‡ªåŠ¨é‡æ–°éƒ¨ç½²

# å†æ¬¡æµ‹è¯•
./test-dmit.sh
```

**æ— éœ€é‡å¯æœåŠ¡å™¨ï¼Œæ— éœ€é‡æ–°éƒ¨ç½²ï¼**

## ğŸ› ï¸ æˆ‘ä¸ºä½ å‡†å¤‡çš„å·¥å…·

### 1. æ–°çš„ npm scripts

```bash
npm run dev:remote      # è¿œç¨‹å¼€å‘æ¨¡å¼ â­
npm run test:watch      # ç›‘å¬æ¨¡å¼è¿è¡Œæµ‹è¯•
npm run test:dmit       # åªæµ‹è¯• Dmit Provider
```

### 2. æµ‹è¯•è„šæœ¬

```bash
./test-dmit.sh                                    # é»˜è®¤ URL
./test-dmit.sh --url "https://www.dmit.io/..."  # è‡ªå®šä¹‰ URL
```

### 3. æµ‹è¯•ç«¯ç‚¹

```
GET /test-dmit?url=<dmit-url>
```

### 4. å®Œæ•´æ–‡æ¡£

- `QUICK_START.md` - å¿«é€Ÿå¼€å§‹æŒ‡å—ï¼ˆæ¨èå…ˆçœ‹ï¼‰
- `LOCAL_DEV_GUIDE.md` - å®Œæ•´çš„æœ¬åœ°å¼€å‘æŒ‡å—
- `README_DMIT_STATUS.md` - Dmit Provider çŠ¶æ€æ€»ç»“
- `CLOUDFLARE_WORKERS_TEST.md` - Workers æµ‹è¯•æŒ‡å—

## ğŸ’¡ å…³é”®ä¼˜åŠ¿

### vs æœ¬åœ°æµ‹è¯•

| ç‰¹æ€§ | æœ¬åœ°æµ‹è¯• | Remote Dev |
|------|----------|------------|
| è¯·æ±‚æ¥æº | æœ¬åœ° IP âŒ | Cloudflare IP âœ… |
| è¢«æ‹¦æˆª | æ˜¯ âŒ | å¯èƒ½ä¸ä¼š âœ… |
| éœ€è¦éƒ¨ç½² | å¦ âœ… | å¦ âœ… |

### vs æ­£å¼éƒ¨ç½²

| ç‰¹æ€§ | æ­£å¼éƒ¨ç½² | Remote Dev |
|------|----------|------------|
| éœ€è¦æäº¤ä»£ç  | æ˜¯ âŒ | å¦ âœ… |
| å®æ—¶æ›´æ–° | å¦ âŒ | æ˜¯ âœ… |
| å…¬å¼€è®¿é—® | æ˜¯ âŒ | å¦ âœ… |
| é€‚åˆæµ‹è¯• | å¦ âŒ | æ˜¯ âœ… |

## ğŸ“ å­¦ä¹ å‚è€ƒ

### æ¬ç“¦å·¥é¡¹ç›®çš„å¯ç¤º

[bwh-stock-monitor](https://github.com/ppvia/bwh-stock-monitor) é¡¹ç›®è¯æ˜ï¼š
- åœ¨ Cloudflare Workers ä¸­è¿è¡Œ
- ä½¿ç”¨ç®€å•çš„ fetch + User-Agent
- **å¯ä»¥ç»•è¿‡åçˆ¬è™«ä¿æŠ¤**

ä½ çš„é¡¹ç›®ä½¿ç”¨ç›¸åŒçš„æ–¹æ³•ï¼Œæ‰€ä»¥æœ‰å¾ˆé«˜æ¦‚ç‡æˆåŠŸï¼

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

```bash
npm run dev:remote -- --log-level debug
```

### åœ¨ä»£ç ä¸­æ·»åŠ æ—¥å¿—

```typescript
console.log('Fetching:', url);
console.log('Status:', response.status);
```

æ—¥å¿—ä¼šæ˜¾ç¤ºåœ¨ wrangler dev çš„ç»ˆç«¯ä¸­ã€‚

### ä½¿ç”¨ curl æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯

```bash
curl -v "http://127.0.0.1:8787/test-dmit?url=..."
```

## â“ å¸¸è§é—®é¢˜

### Q: Remote dev ä¼šæ¶ˆè€—é…é¢å—ï¼Ÿ

ä¼šï¼Œä½†éå¸¸å°‘ã€‚å…è´¹è®¡åˆ’æ¯å¤© 100,000 æ¬¡è¯·æ±‚ï¼Œæµ‹è¯•è¿œä½äºæ­¤ã€‚

### Q: å¦‚ä½•åœæ­¢ remote devï¼Ÿ

åœ¨ç»ˆç«¯æŒ‰ `Ctrl+C`ã€‚

### Q: ä¿®æ”¹ä»£ç åéœ€è¦é‡å¯å—ï¼Ÿ

ä¸éœ€è¦ï¼ä¿å­˜æ–‡ä»¶åè‡ªåŠ¨é‡æ–°éƒ¨ç½²ã€‚

### Q: æµ‹è¯•è„šæœ¬éœ€è¦ä»€ä¹ˆä¾èµ–ï¼Ÿ

éœ€è¦ `jq`ï¼ˆJSON å¤„ç†å·¥å…·ï¼‰ï¼š

```bash
# macOS
brew install jq

# æˆ–è€…ä¸ç”¨è„šæœ¬ï¼Œç›´æ¥ç”¨ curl
curl "http://127.0.0.1:8787/test-dmit?url=..."
```

## ğŸ“‹ å®Œæ•´å‘½ä»¤æ¸…å•

```bash
# 1. å¯åŠ¨ remote dev
npm run dev:remote

# 2. æµ‹è¯•ï¼ˆé€‰æ‹©ä¸€ç§ï¼‰
./test-dmit.sh                                    # ä½¿ç”¨è„šæœ¬
curl "http://127.0.0.1:8787/test-dmit?url=..."   # ä½¿ç”¨ curl
open "http://127.0.0.1:8787/test-dmit?url=..."   # ä½¿ç”¨æµè§ˆå™¨

# 3. æµ‹è¯•ä¸åŒ URL
./test-dmit.sh --url "https://www.dmit.io/cart.php?gid=1"
./test-dmit.sh --url "https://www.dmit.io/cart.php?gid=2"

# 4. è¿è¡Œå•å…ƒæµ‹è¯•
npm test
npm run test:watch
npm run test:dmit

# 5. ä»£ç æ£€æŸ¥
npm run lint
npm run format
```

## ğŸ¯ ä¸‹ä¸€æ­¥

### å¦‚æœæµ‹è¯•æˆåŠŸ âœ…

1. âœ… ç¡®è®¤å¯ä»¥ç»•è¿‡ Cloudflare
2. ç»§ç»­å¼€å‘ç›‘æ§åŠŸèƒ½
3. å®ç° KV å­˜å‚¨
4. æ·»åŠ é€šçŸ¥åŠŸèƒ½
5. è®¾ç½® Cron å®šæ—¶ä»»åŠ¡
6. æ­£å¼éƒ¨ç½²ï¼š`npm run deploy`

### å¦‚æœæµ‹è¯•å¤±è´¥ âŒ

æŸ¥çœ‹å¤‡é€‰æ–¹æ¡ˆï¼š
- `DMIT_CLOUDFLARE_SOLUTION.md`
- è€ƒè™‘ Browser Rendering
- è€ƒè™‘ä»£ç†æœåŠ¡

## ğŸš€ ç°åœ¨å°±å¼€å§‹

```bash
# ä¸€é”®å¯åŠ¨
npm run dev:remote
```

ç„¶ååœ¨æ–°ç»ˆç«¯ï¼š

```bash
# ä¸€é”®æµ‹è¯•
./test-dmit.sh
```

---

**æ€»ç»“**: ä½ **ä¸éœ€è¦**æäº¤ä»£ç æˆ–æ­£å¼éƒ¨ç½²å°±èƒ½æµ‹è¯•ã€‚ä½¿ç”¨ `npm run dev:remote` å³å¯åœ¨ Cloudflare ç¯å¢ƒä¸­å®æ—¶æµ‹è¯•ï¼ğŸ‰
